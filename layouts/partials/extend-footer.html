<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
<script>
  (function () {
    function initQslLightbox() {
      // Only run if this page actually has QSL links
      var links = document.querySelectorAll("a.qslbox");
      if (!links.length) return;

      // If we've already created an instance, destroy it before re-creating
      if (window.__qslLightboxInstance && typeof window.__qslLightboxInstance.destroy === "function") {
        try { window.__qslLightboxInstance.destroy(); } catch (e) {}
      }

      if (typeof GLightbox !== "function") return;

      window.__qslLightboxInstance = GLightbox({ selector: "a.qslbox" });
    }

    // Normal full page load
    document.addEventListener("DOMContentLoaded", initQslLightbox);

    // Some themes swap content without reloading the page; catch common events
    window.addEventListener("load", initQslLightbox);
    document.addEventListener("swup:contentReplaced", initQslLightbox);
    document.addEventListener("turbo:load", initQslLightbox);

    // Also re-run after any click (covers “instant navigation” patterns)
    document.addEventListener("click", function () {
      setTimeout(initQslLightbox, 0);
    }, true);
  })();
</script>
